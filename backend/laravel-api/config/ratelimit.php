<?php

declare(strict_types=1);

/**
 * レート制限設定
 *
 * エンドポイントごとの動的レート制限設定を管理します。
 * ログイン、認証済みAPI、公開APIなど、エンドポイントタイプ別の制限値を定義します。
 *
 * Requirements: 3.2, 3.7, 3.8, 3.9, 3.11, 13.2
 */
return [
    /*
    |--------------------------------------------------------------------------
    | エンドポイント別レート制限設定
    |--------------------------------------------------------------------------
    |
    | 各エンドポイントタイプのレート制限設定です。
    | - requests: 許可するリクエスト数
    | - per_minute: レート制限の時間単位（分）
    | - by: レート制限の識別子（ip/user/token）
    |
    */
    'endpoints' => [
        /*
        |----------------------------------------------------------------------
        | ログインエンドポイント
        |----------------------------------------------------------------------
        |
        | ブルートフォース攻撃対策として厳しい制限を設定
        | IPアドレス単位で1分間に5回まで
        |
        */
        'login' => [
            'requests' => 5,
            'per_minute' => 1,
            'by' => 'ip',
        ],

        /*
        |----------------------------------------------------------------------
        | 認証済みAPIエンドポイント
        |----------------------------------------------------------------------
        |
        | 認証されたユーザーのAPI利用制限
        | ユーザーID単位で1分間に1000回まで
        |
        */
        'api' => [
            'requests' => 1000,
            'per_minute' => 1,
            'by' => 'user',
        ],

        /*
        |----------------------------------------------------------------------
        | 公開APIエンドポイント
        |----------------------------------------------------------------------
        |
        | 認証不要の公開API制限
        | IPアドレス単位で1分間に100回まで
        |
        */
        'public' => [
            'requests' => 100,
            'per_minute' => 1,
            'by' => 'ip',
        ],

        /*
        |----------------------------------------------------------------------
        | 内部APIエンドポイント
        |----------------------------------------------------------------------
        |
        | サーバー間通信や管理者用API制限
        | ユーザーID単位で1分間に5000回まで
        |
        */
        'internal' => [
            'requests' => 5000,
            'per_minute' => 1,
            'by' => 'user',
        ],

        /*
        |----------------------------------------------------------------------
        | Webhookエンドポイント
        |----------------------------------------------------------------------
        |
        | 外部サービスからのWebhook受信制限
        | トークン単位で1分間に200回まで
        |
        */
        'webhook' => [
            'requests' => 200,
            'per_minute' => 1,
            'by' => 'token',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | キャッシュストア設定
    |--------------------------------------------------------------------------
    |
    | レート制限カウンターの保存先設定です。
    | Redisを使用して高速な分散カウントを実現します。
    |
    */
    'cache' => [
        'store' => 'redis',
        'prefix' => 'rate_limit',
    ],
];
